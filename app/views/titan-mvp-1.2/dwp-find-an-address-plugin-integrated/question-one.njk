{% extends "layouts/main.html" %}

{% block pageTitle %}
  Question one - GOV.UK Prototype Kit
{% endblock %}

{% block content %}

  {{ govukBackLink({
    text: "Back",
    href: "javascript: window.history.go(-1)"
  }) }}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {% if error %}
        {{ govukErrorSummary({
          titleText: "There is a problem",
          errorList: [
            {
              text: error.nameError,
              href: "#name"
            } if error.nameError else "",
            {
              text: error.emailError,
              href: "#email"
            } if error.emailError else "",
            {
              text: error.addressError,
              href: "#address-postcode"
            } if error.addressError else ""
          ]
        }) }}
      {% endif %}

      <form method="post" autocomplete="off">
        <h1 class="govuk-heading-l">Your details</h1>


          {{ govukInput({
            label: {
              text: "Full name",
            classes: "govuk-label--m"
            },
            id: "name",
            name: "name",
            errorMessage: { text: error.nameError } if error.nameError else "",
            value: data['name'],
            autocomplete: "name"
          }) }}

            <div id="address" class="govuk-form-group">
{% call govukFieldset({
  legend: {
    text: "What is your address?",
    classes: "govuk-fieldset__legend--m",
    isPageHeading: false
  }
}) %}
            {% if data.addressMode == "manual" %}
              {# Manual address entry #}
              <div class="govuk-form-group">
                {{ govukInput({
                  label: {
                    text: "Address line 1"
                  },
                  id: "address-line-1",
                  name: "addressLine1",
                  value: data['addressLine1'],
                  autocomplete: "address-line1"
                }) }}

                {{ govukInput({
                  label: {
                    text: "Address line 2 (optional)"
                  },
                  id: "address-line-2",
                  name: "addressLine2",
                  value: data['addressLine2'],
                  autocomplete: "address-line2"
                }) }}

                {{ govukInput({
                  label: {
                    text: "Town or city"
                  },
                  classes: "govuk-!-width-two-thirds",
                  id: "town-city",
                  name: "townCity",
                  value: data['townCity'],
                  autocomplete: "address-level2"
                }) }}

                {{ govukInput({
                  label: {
                    text: "Postcode"
                  },
                  classes: "govuk-input--width-10",
                  id: "address-postcode",
                  name: "addressPostcode",
                  value: data['addressPostcode'],
                  autocomplete: "postal-code"
                }) }}
              </div>

              <p class="govuk-body govuk-!-padding-top-4">
                <a href="?addressMode=lookup" class="govuk-link ">Find an address instead</a>
              </p>

            {% else %}
              {# Address lookup mode #}
              {% if data.addressResults and data.addressResults.length > 0 %}
                {# Show address selection when results are available #}
                {# <div class="govuk-form-group"> #}
                  <p class="govuk-body">{{ data.addressResults.length }} addresses found for
                    <strong>{{ data.addressPostcode }}</strong>.
                    <a href="?addressMode=lookup&clearResults=true" class="govuk-link">Search again</a>
                  </p>

                  {% set addressItems = [] %}

                  {% set addressItems = (addressItems.push(
                    {
                      value: "",
                      text: "Select an address"
                    }
                  ), addressItems) %}

                  {% for result in data.addressResults %}
                    {% set addressItems = (addressItems.push(result), addressItems) %}
                  {% endfor %}

                  {{ govukSelect({
                    id: "select-address",
                    name: "selectAddress",
                    label: {
                      text: "Select an address"
                    },
                    items: addressItems
                  }) }}

                  <p class="govuk-body govuk-!-margin-top-2">
                    <a href="?addressMode=manual" class="govuk-link">Enter address manually</a>
                  </p>
                {# </div> #}

                {% if data.selectedAddress %}
                  <div class="govuk-inset-text">
                    {{ data.selectedAddress }}
                  </div>
                {% endif %}
              {% else %}
                {# Show postcode lookup when no results or first time #}
                {# <div class="govuk-form-group"> #}
                  {{ govukInput({
                    label: {
                      text: "Postcode"
                    },
                    classes: "govuk-input--width-10",
                    id: "address-postcode",
                    name: "addressPostcode",
                    errorMessage: { text: error.addressError } if error.addressError else "",
                    value: data['addressPostcode'],
                    autocomplete: "postal-code"
                  }) }}

                  <div class="govuk-button-group">
                    {{ govukButton({
                      text: "Find address",
                      name: "action",
                      value: "lookup",
                      classes: "govuk-button--secondary govuk-!-margin-right-1"
                    }) }}

                    <p class="govuk-body">or <a href="?addressMode=manual" class="govuk-link">enter address manually</a></p>
                  </div>
                {# </div> #}

              {% endif %}
            {% endif %}
          {# </div> #}

          <input type="hidden" name="addressMode" value="{{ data.addressMode or 'lookup' }}">
          {% endcall %}

{{ govukInput({
  label: {
    text: "Email address",
    classes: "govuk-label--m"
  },
  hint: {
    text: "Weâ€™ll only use this to send you a receipt"
  },
  id: "email",
  name: "email",
  type: "email",
  autocomplete: "email",
  spellcheck: false,
  errorMessage: { text: error.emailError } if error.emailError else "",
  value: data['email']
}) }}


<div class="govuk-button-group">
          {{ govukButton({
            text: "Save and continue",
            name: "action",
            value: "continue"
          }) }}

          {{ govukButton({
            text: "Save and exit",
            classes: "govuk-button--secondary",
            name: "action",
            value: "exit"
          }) }}
        </div>
      </form>
    </div>
  </div>
{% endblock %}
